\RequirePackage[final]{listings}
\RequirePackage{relsize}
\input{javascript.def}
\input{smalltalk.def}
\input{newspeak.def}
\input{lua.def}
\lstdefinelanguage{Self}[]{Smalltalk}{}

\RequirePackage{textcomp}

% ZEBRA
\makeatletter
\newcommand{\zebra}{
    \begingroup
    \ifodd\value{lstnumber}
        \color{Gray!5}
    \else
        \color{White}
    \fi
    \rlap{
     \hspace*{-5pt}
        \color@block{\linewidth}{\ht\strutbox}{\dp\strutbox}
    }
    \endgroup
}
\makeatother

\newcommand{\sdvspace}{
    \stepcounter{seqlevel}
}

\lstset{
    language=Newspeak,
    % BASIC STYLE
    aboveskip=25pt,
    basicstyle=\ttfamily,
    lineskip=-.5ex,
    escapechar=\`,
    % KEYWORDS
    keywordstyle=\bfseries,
    % morekeywords=[2]{
    %   with
    % },
    % keywordstyle={[3]\color{Emerald}\textit},
    % keywords=[3]{
    %   True, False
    % },
    % keywordstyle={[4]\color{Red}},
    % keywords=[4]{
    %   @contextmanager
    % },
    % STRING
    stringstyle=\color{Green},
    showstringspaces=false,
    upquote=true,
    % COMMENT
    commentstyle=\color{RoyalBlue}\slshape,
    % LINES
    xleftmargin=15pt,
    xrightmargin=-15pt,
    numbers=left,
    stepnumber=1,
    numberstyle=\zebra\tiny\color{black!60},
    tabsize=2,
    % CAPTION
    captionpos=b,
    % FRAME
    frame=lines,
    framexleftmargin=15.5pt,
    framexrightmargin=-15.5pt,
    framextopmargin=3pt,
    framexbottommargin=3pt,
    framesep=0pt,
    resetmargins=true,
    % POSITION
    columns=fullflexible,
    float=htpb,
    floatplacement=hbtp
}

\providecaptionname{english}{\lstlistlistingname}{List of Listings}
\providecaptionname{german}{\lstlistlistingname}{Listingverzeichnis}
\providecaptionname{ngerman}{\lstlistlistingname}{Listingverzeichnis}
% \renewcaptionname{english}{\lstlistlistingname}{List of Listings}
% \renewcaptionname{german}{\lstlistlistingname}{Listingverzeichnis}
% \renewcaptionname{ngerman}{\lstlistlistingname}{Listingverzeichnis}


\newcommand{\swaListingInlineMode}{
  \lstset{%
    columns=fullflexible,
    basicstyle=\ttfamily
  }}

\newcommand{\swaListingMode}{
  \lstset{%
    columns=[c]fixed,
    basicstyle=\smaller\ttfamily,
  }}

\swaListingInlineMode


\lstnewenvironment{code}[3][]%
{
\swaListingMode
\lstset{
label=#1,
caption={#2},
#3
}}{
\swaListingInlineMode
}

\endinput
    ;; New environments
    (LaTeX-add-environments
     '("code" LaTeX-env-args
       [TeX-arg-key-val LaTeX-listings-key-val-options]))
    (add-to-list 'LaTeX-indent-environment-list
		 '("code" current-indentation))
    (make-local-variable 'LaTeX-verbatim-regexp)
    (setq LaTeX-verbatim-regexp (concat LaTeX-verbatim-regexp "\\|code"))
    (add-to-list 'LaTeX-verbatim-environments-local "code")

    (reftex-add-to-label-alist 
        '(("\\begin{code}[*]{}{}" ?c "lst:" "\\ref{%s}" caption nil)))
