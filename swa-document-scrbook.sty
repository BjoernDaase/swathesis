%
% KOMA-specific properties
%
\@ifclassloaded{scrbook}{}{%
  % not koma
  \PackageError{swa-document-scrbook}{
    This package should only be used with KOMA script
  }{
    You might consider loading swa-document.
    }
}



\KOMAoptions{
    pagesize,
    DIV=9,
    open=right,
    appendixprefix=true,
    % headinclude=true,
    % footinclude=true
  }
\areaset[current]{\textwidth}{1.61803399\textwidth}


\RequirePackage{tocstyle}
\usetocstyle{KOMAlike}

\setfootnoterule{4cc}

%\RequirePackage[hang,small,bf]{caption}
\setcapindent{1em}
\addtokomafont{caption}{\small}
\addtokomafont{captionlabel}{\bfseries}


\RequirePackage{enumitem}
\setlist{noitemsep,topsep=.5\baselineskip,leftmargin=1em}
\setdescription{noitemsep,font=\normalfont\scshape,leftmargin=\parindent}

% koma-hacks
\RequirePackage{scrhack}

% undo babel thing in tocbasic
\unsettoc{toc}{nobabel}
\unsettoc{lof}{nobabel}
\unsettoc{lot}{nobabel}

\setuptoc{toc}{noprotrusion}
\setuptoc{lof}{noprotrusion}
\setuptoc{lot}{noprotrusion}
\setuptoc{lol}{noprotrusion}
\setuptoc{loa}{noprotrusion}

\tocbasicautomode

%
% design
%
\setkomafont{subtitle}{\usekomafont{title}\LARGE}
% \setkomafont{disposition}{\rmfamily\mdseries\scshape}
\addtokomafont{disposition}{\rmfamily}
\setkomafont{title}{\rmfamily\mdseries}

\@ifpackagelater{scrbase}{2014/10/28}{%
  \RedeclareSectionCommand[%
    beforeskip=-2\baselineskip,afterskip=\baselineskip]{section}
  \RedeclareSectionCommand[%
    beforeskip=-\baselineskip,afterskip=\baselineskip]{subsection}
  \RedeclareSectionCommand[%
    beforeskip=-\baselineskip,afterskip=1sp plus -1sp minus 1sp]{subsubsection}
  \RedeclareSectionCommand[%
    beforeskip=\baselineskip]{paragraph}
  \RedeclareSectionCommand[%
    beforeskip=\baselineskip]{subparagraph}
}{
  % for sections, not so easy.
  \def\TR@patchw{\TR@warn{Cannot patch sectioning command.\MessageBreak This is
      not severe.}}
  \patchcmd{\section}{-3.5ex \@plus -1ex \@minus -.2ex}{-2\baselineskip}{}{\TR@patchw}
  \patchcmd{\section}{2.3ex \@plus.2ex}{\baselineskip}{}{\TR@patchw}
  \patchcmd{\subsection}{-3.25ex\@plus -1ex \@minus -.2ex}{-\baselineskip}{}{\TR@patchw}
  \patchcmd{\subsection}{1.5ex \@plus .2ex}{\baselineskip}{}{\TR@patchw}
  \patchcmd{\subsubsection}{-3.25ex\@plus -1ex \@minus -.2ex}{-\baselineskip}{}{\TR@patchw}
  \patchcmd{\subsubsection}{1.5ex \@plus .2ex}{1sp \@plus 1sp \@minus 1sp}{}{\TR@patchw}
  \patchcmd{\paragraph}{3.25ex \@plus1ex \@minus .2ex}{\baselineskip}{}{\TR@patchw}
  \patchcmd{\subparagraph}{3.25ex \@plus1ex \@minus .2ex}{\baselineskip}{}{\TR@patchw}
}

\AtEndPreamble{
  % redo document stuff:
  \ifundefinedorrelax{hypersetup}{}{%
    \hypersetup{
      pdftitle={\@title{}: \@subtitle},
      pdfauthor={\@author},
      pdfsubject={\@subject}
    }
  }
}

